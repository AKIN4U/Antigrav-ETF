// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Applicant {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Personal Info
  surname       String
  firstName     String
  middleName    String?
  age           Int
  dob           DateTime
  sex           String
  stateOrigin   String
  lga           String
  town          String
  address       String
  phone         String
  email         String?  @unique // Optional for children, but good for contact
  parish        String   @default("Central Cathedral Abuja")

  // Previous Scholarship
  prevScholarship     Boolean @default(false)
  prevScholarshipDate String?

  // Relations
  applications Application[]
  familyInfo   FamilyInfo?
  alumniProfile AlumniProfile?
}

model AlumniProfile {
  id          String   @id @default(cuid())
  applicantId String   @unique
  applicant   Applicant @relation(fields: [applicantId], references: [id])
  
  graduationYear Int
  institution    String?
  degree         String?
  
  currentStatus  String? // e.g. "Employed", "Self-Employed", "Further Studies", "Seeking Job"
  employer       String?
  jobTitle       String?
  
  linkedInUrl    String?
  successStory   String? // Text area for details
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model FamilyInfo {
  id          String    @id @default(uuid())
  applicantId String    @unique
  applicant   Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)

  // Father
  fatherSurname       String?
  fatherFirstName     String?
  fatherMiddleName    String?
  fatherAddress       String?
  fatherPhone         String?
  fatherState         String?
  fatherLga           String?
  fatherTown          String?
  fatherOccupation    String?
  fatherEmployer      String?
  fatherSalaryGrade   String?
  fatherIncome        String?
  fatherObligations   String?
  fatherSpouse        String?
  fatherNumChildren   Int?
  fatherChildrenAges  String?
  fatherYearsServed   String?
  fatherChurchPosition String?
  fatherChurchDuties  String?

  // Mother
  motherSurname       String?
  motherFirstName     String?
  motherMiddleName    String?
  motherAddress       String?
  motherPhone         String?
  motherState         String?
  motherLga           String?
  motherTown          String?
  motherOccupation    String?
  motherEmployer      String?
  motherSalaryGrade   String?
  motherIncome        String?
  motherObligations   String?
  motherSpouse        String?
  motherNumChildren   Int?
  motherChildrenAges  String?
  motherYearsServed   String?
  motherChurchPosition String?
  motherChurchDuties  String?
}

model Application {
  id          String    @id @default(uuid())
  applicantId String
  applicant   Applicant @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  status      String    @default("Pending") // Pending, Under Review, Approved, Rejected, Disbursed

  // Academic Info (Snapshot for this application)
  schoolName      String
  schoolAddress   String
  presentClass    String
  classPosition   String?
  classSize       Int?
  schoolFees      String
  textBooksCost   String?
  enoughBooks     Boolean @default(false)
  libraryAccess   Boolean @default(false)
  sentAway        Boolean @default(false)
  repeatedClass   Boolean @default(false)
  lastResult      String? // CGPA or Average

  // Documents (URLs or paths)
  schoolBillUrl       String?
  birthCertUrl        String?
  primaryCertUrl      String?
  schoolResultUrl     String?
  assistanceLetterUrl String?
  admissionLetterUrl  String?
  passportUrl         String?

  // Admin/Screening
  scoreFinancial    Int?
  scoreAcademic     Int?
  scoreChurch       Int?
  committeeNotes    String?
  approvedAmount  String?
  voucherCode     String?
  disbursedDate   DateTime?
  paymentReference String?

  assessments     Assessment[] // Relation to assessments
}

model AdminUser {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  role      String   @default("Admin") // Admin, SuperAdmin, Committee
  status    String   @default("Pending") // Pending, Approved, Rejected
  assessments Assessment[]
  createdAt DateTime @default(now())
}

model Assessment {
  id            String    @id @default(uuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  adminUserId   String
  adminUser     AdminUser @relation(fields: [adminUserId], references: [id])
  
  // Scores
  financialScore Int      @default(0)
  academicScore  Int      @default(0)
  churchScore    Int      @default(0)
  totalScore     Int      @default(0)
  
  notes          String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@unique([applicationId, adminUserId]) // One assessment per admin per application
}

model Budget {
  id          String   @id @default(uuid())
  year        Int
  quarter     Int?     // 1, 2, 3, 4 or null for annual
  category    String   // Scholarships, Operations, Events, etc.
  allocated   Decimal  @db.Decimal(12, 2)
  spent       Decimal  @db.Decimal(12, 2) @default(0)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  transactions Transaction[]

  @@unique([year, quarter, category])
}

model Transaction {
  id            String   @id @default(uuid())
  budgetId      String?
  budget        Budget?  @relation(fields: [budgetId], references: [id])
  type          String   // Income, Expense, Transfer
  category      String   // Donation, Scholarship, Operations, etc.
  amount        Decimal  @db.Decimal(12, 2)
  description   String
  reference     String?  // Invoice number, receipt number, etc.
  date          DateTime
  createdBy     String?  // Admin user email
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  donation      Donation?
}

model Donation {
  id              String   @id @default(uuid())
  transactionId   String   @unique
  transaction     Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  donorName       String
  donorEmail      String?
  donorPhone      String?
  donorAddress    String?
  donationType    String   // One-time, Monthly, Annual
  isAnonymous     Boolean  @default(false)
  purpose         String?  // General, Scholarship, Infrastructure, etc.
  receiptIssued   Boolean  @default(false)
  receiptNumber   String?
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model AuditLog {
  id        String   @id @default(cuid())
  action    String   // e.g. "APPROVE_APPLICATION", "CREATE_USER"
  details   String?  // JSON string or text description
  userId    String?  // ID of the admin who performed the action
  userEmail String?  // Email for easier reading
  ipAddress String? 
  createdAt DateTime @default(now())
}
